<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Cart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
    
<body class="p-4" style=" background-color:rgb(255, 255, 233)">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 style="margin: auto;"> Your Cart</h2>
    </div>

    <div id="cart-container" class="row" ></div>

    <div id="cart-summary" class="mt-4 p-3  shadow-sm rounded" style=" background-color:rgb(254, 240, 189)"></div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const data = params.get("data");
    let cart = [];
    if (data) {
      try { cart = JSON.parse(decodeURIComponent(data)); } catch (e) { cart = []; }
    }

    function updateBackLink() {
      const encoded = encodeURIComponent(JSON.stringify(cart));
      document.getElementById("back-shop").href = "index.html?data=" + encoded;
    }

    function renderCart() {
      const container = document.getElementById("cart-container");
      const summary = document.getElementById("cart-summary");
      container.innerHTML = "";
      let grandTotal = 0;

      if (!cart || cart.length === 0) {
        container.innerHTML = '<p>Your cart is empty.</p>';
        summary.innerHTML = "";
        updateBackLink();
        return;
      }

      cart.forEach((item, idx) => {
        const price = Number(item.price); 
        const total = price * (item.quantity || 1);
        grandTotal += total;

        const col = document.createElement("div");
        col.className = "col-md-3 mb-4";
        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <img src="${item.img}" class="card-img-top" alt="${item.name}" style="height:180px;object-fit:cover">
            <div class="card-body text-center">
              <h6 class="card-title">${item.name}</h6>
              <p class="card-text fw-bold">$${price}</p>
              <div class="d-flex justify-content-center align-items-center gap-2 mt-2">
                <button class="btn btn-sm btn-outline-secondary qty-minus">-</button>
                <span class="fw-bold qty-display">${item.quantity}</span>
                <button class="btn btn-sm btn-outline-secondary qty-plus">+</button>
              </div>
              <p class="mt-2 text-success">Total: $${total}</p>
            </div>
            <div class="card-footer text-center">
              <button class="btn btn-danger btn-sm remove" style="background-color:rgba(153, 88, 41, 1);border:2px solid rgba(153, 88, 41, 1);color:black">Remove</button>
            </div>
          </div>
        `;
        col.querySelector(".qty-plus").addEventListener("click", () => {
          cart[idx].quantity = (cart[idx].quantity || 1) + 1;
          renderCart();
        });
        col.querySelector(".qty-minus").addEventListener("click", () => {
          if ((cart[idx].quantity || 1) > 1) {
            cart[idx].quantity -= 1;
          } else {
            cart.splice(idx, 1);
          }
          renderCart();
        });
        col.querySelector(".remove").addEventListener("click", () => {
          cart.splice(idx, 1);
          renderCart();
        });

        container.appendChild(col);
      });

      summary.innerHTML = `
        <h5>Cart Summary</h5>
        <p><strong>Grand Total: $${grandTotal}</strong></p>
      `;

      updateBackLink();
    }
    document.addEventListener("DOMContentLoaded", () => {
      renderCart();
    });
  </script>
</body>
</html>
